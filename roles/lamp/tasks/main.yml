---
- name: Ensure LAMP directories
  ansible.builtin.file:
    path: "{{ item }}"
    state: directory
    mode: '0755'
  loop:
    - /var/www/html
    - /opt/ai-stack/lamp/db
    - /opt/ai-stack/lamp/sites-enabled
    - /opt/ai-stack/lamp/htpasswd
    - /opt/ai-stack/lamp/postgres/data

- name: Create custom Apache config include
  ansible.builtin.copy:
    dest: /opt/ai-stack/lamp/custom-modules.conf
    mode: '0644'
    content: |
      # Custom global Apache module loading and settings
      # Add any LoadModule or other server-level directives here

      LoadModule rewrite_module /usr/lib/apache2/modules/mod_rewrite.so

      # Optional extras you might need later (uncomment as needed)
      LoadModule headers_module /usr/lib/apache2/modules/mod_headers.so
      LoadModule expires_module /usr/lib/apache2/modules/mod_expires.so
      LoadModule deflate_module /usr/lib/apache2/modules/mod_deflate.so

      # Example: global rewrite base if you want
      RewriteEngine On
